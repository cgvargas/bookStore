#!/usr/bin/env python
"""
Execu√ß√£o direta da expans√£o - Itens 4-10
Execu√ß√£o: execute_expansion_4_10.py
"""

import os
import sys
import django

# Configurar Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'cgbookstore.config.settings')
sys.path.append(os.path.dirname(os.path.abspath(__file__)))
django.setup()

from cgbookstore.apps.chatbot_literario.services import training_service


def main():
    print("üöÄ EXECU√á√ÉO IMEDIATA - EXPANS√ÉO ITENS 4-10")
    print("=" * 60)

    print("üìä Status inicial:")
    stats = training_service.get_knowledge_stats()
    print(f"   üìö Itens ativos: {stats.get('active_items', 0)}")
    print(f"   üß† Com embeddings: {stats.get('with_embeddings', 0)}")

    # Lista de itens a adicionar
    items_to_add = [
        {
            "question": "Quem foi Jos√© de Alencar?",
            "answer": """Jos√© Martiniano de Alencar (1829-1877) foi um dos principais escritores do Romantismo brasileiro, considerado o criador do romance brasileiro e grande defensor da literatura nacional.

BIOGRAFIA:
‚Ä¢ Nascimento: 1¬∫ de maio de 1829, Messejana, Cear√°
‚Ä¢ Forma√ß√£o: Direito em S√£o Paulo e Olinda
‚Ä¢ Carreiras: Advogado, jornalista, pol√≠tico, escritor
‚Ä¢ Atua√ß√£o pol√≠tica: Deputado, Ministro da Justi√ßa
‚Ä¢ Morte: 12 de dezembro de 1877, Rio de Janeiro

CARACTER√çSTICAS LITER√ÅRIAS:
‚Ä¢ Criador do romance de tem√°tica brasileira
‚Ä¢ Exalta√ß√£o da natureza e do √≠ndio brasileiro
‚Ä¢ Linguagem adaptada ao portugu√™s brasileiro
‚Ä¢ Defesa da independ√™ncia liter√°ria nacional
‚Ä¢ Estilo rom√¢ntico com cor local

OBRAS PRINCIPAIS:
‚Ä¢ Indianistas: "O Guarani", "Iracema", "Ubirajara"
‚Ä¢ Urbanos: "Senhora", "Luc√≠ola", "Diva"
‚Ä¢ Regionais: "O Ga√∫cho", "O Sertanejo"
‚Ä¢ Teatro: "O Dem√¥nio Familiar", "M√£e"

IMPORT√ÇNCIA:
Jos√© de Alencar foi fundamental para estabelecer uma identidade pr√≥pria √† literatura brasileira, criando personagens e temas genuinamente nacionais, especialmente atrav√©s da idealiza√ß√£o do √≠ndio como her√≥i rom√¢ntico.""",
            "category": "author"
        },
        {
            "question": "O que √© Iracema de Jos√© de Alencar?",
            "answer": """Iracema √© um romance indianista de Jos√© de Alencar, publicado em 1865, considerado uma das obras-primas do Romantismo brasileiro. Subtitulado "Lenda do Cear√°", narra a hist√≥ria de amor entre a √≠ndia Iracema e o portugu√™s Martim.

ENREDO CENTRAL:
‚Ä¢ Iracema: √≠ndia tabajara, guardi√£ do segredo da jurema
‚Ä¢ Martim: guerreiro portugu√™s que se perde na floresta
‚Ä¢ Romance proibido entre os dois personagens
‚Ä¢ Nascimento de Moacir, primeiro cearense
‚Ä¢ Alegoria da forma√ß√£o do povo brasileiro

CARACTER√çSTICAS LITER√ÅRIAS:
‚Ä¢ Linguagem po√©tica e musical
‚Ä¢ Fus√£o de lenda ind√≠gena com hist√≥ria
‚Ä¢ Exalta√ß√£o da natureza brasileira
‚Ä¢ Idealiza√ß√£o do √≠ndio e do amor
‚Ä¢ Nacionalismo rom√¢ntico

SIMBOLISMO:
‚Ä¢ Iracema = anagrama de "Am√©rica"
‚Ä¢ Moacir = "filho da dor" (primeiro mesti√ßo)
‚Ä¢ Martim = elemento colonizador europeu
‚Ä¢ Uni√£o = s√≠mbolo da miscigena√ß√£o brasileira

FRASES FAMOSAS:
"Iracema, a virgem dos l√°bios de mel"
"Onde vai a afoita jandaia?"

LEGADO:
Iracema tornou-se s√≠mbolo do Cear√° e da literatura brasileira, representando o mito fundador da nacionalidade atrav√©s do encontro entre culturas.""",
            "category": "book"
        },
        {
            "question": "O que foi o Romantismo no Brasil?",
            "answer": """O Romantismo brasileiro (1836-1881) foi um movimento liter√°rio que marcou a independ√™ncia cultural do Brasil, coincidindo com a independ√™ncia pol√≠tica e a forma√ß√£o da identidade nacional.

MARCO INICIAL:
‚Ä¢ 1836: "Suspiros Po√©ticos e Saudades" de Gon√ßalves de Magalh√£es
‚Ä¢ Revista Niter√≥i: manifesto rom√¢ntico brasileiro
‚Ä¢ Influ√™ncia: Romantismo europeu adaptado ao Brasil

CARACTER√çSTICAS GERAIS:
‚Ä¢ Nacionalismo e exalta√ß√£o da p√°tria
‚Ä¢ Valoriza√ß√£o da natureza tropical
‚Ä¢ Idealiza√ß√£o do √≠ndio como her√≥i nacional
‚Ä¢ Sentimentalismo e subjetivismo
‚Ä¢ Escapismo e medievalismo
‚Ä¢ Linguagem emocional e popular

GERA√á√ïES/FASES:
1¬™ GERA√á√ÉO (Nacionalista/Indianista):
‚Ä¢ Gon√ßalves Dias, Jos√© de Alencar
‚Ä¢ Temas: p√°tria, natureza, √≠ndio

2¬™ GERA√á√ÉO (Ultrarrom√¢ntica/Byroniana):
‚Ä¢ √Ålvares de Azevedo, Casimiro de Abreu
‚Ä¢ Temas: morte, amor imposs√≠vel, melancolia

3¬™ GERA√á√ÉO (Condoreira/Social):
‚Ä¢ Castro Alves, Tobias Barreto
‚Ä¢ Temas: aboli√ß√£o, rep√∫blica, justi√ßa social

PRINCIPAIS AUTORES:
‚Ä¢ Poesia: Gon√ßalves Dias, Castro Alves, √Ålvares de Azevedo
‚Ä¢ Prosa: Jos√© de Alencar, Manuel Ant√¥nio de Almeida
‚Ä¢ Teatro: Martins Pena, Jos√© de Alencar

IMPORT√ÇNCIA:
O Romantismo consolidou a literatura brasileira como express√£o aut√¥noma, criando uma identidade cultural nacional.""",
            "category": "movement"
        },
        {
            "question": "Como analisar personagens na literatura?",
            "answer": """A an√°lise de personagens √© fundamental para compreender uma obra liter√°ria. Os personagens s√£o os elementos que vivenciam os conflitos e desenvolvem os temas da narrativa.

TIPOS DE PERSONAGENS:
‚Ä¢ Protagonista: personagem principal
‚Ä¢ Antagonista: opositor do protagonista
‚Ä¢ Secund√°rios: apoiam a trama principal
‚Ä¢ Figurantes: aparecem ocasionalmente

CLASSIFICA√á√ÉO POR COMPLEXIDADE:
‚Ä¢ Planos/Simples: uma caracter√≠stica dominante
‚Ä¢ Redondos/Complexos: m√∫ltiplas caracter√≠sticas, evoluem
‚Ä¢ Est√°ticos: n√£o mudam durante a narrativa
‚Ä¢ Din√¢micos: transformam-se ao longo da hist√≥ria

M√âTODOS DE CARACTERIZA√á√ÉO:
‚Ä¢ Direta: narrador descreve explicitamente
‚Ä¢ Indireta: revela√ß√£o atrav√©s de a√ß√µes, falas, pensamentos
‚Ä¢ Autocaracteriza√ß√£o: personagem se revela
‚Ä¢ Heterocaracteriza√ß√£o: outros personagens o descrevem

ASPECTOS A ANALISAR:
‚Ä¢ F√≠sicos: apar√™ncia, gestos, vestimentas
‚Ä¢ Psicol√≥gicos: personalidade, motiva√ß√µes, conflitos internos
‚Ä¢ Sociais: classe, profiss√£o, relacionamentos
‚Ä¢ Morais: valores, princ√≠pios, comportamentos

EXEMPLOS CL√ÅSSICOS:
‚Ä¢ Capitu (Dom Casmurro): complexidade psicol√≥gica
‚Ä¢ Bentinho: narrador n√£o-confi√°vel
‚Ä¢ Rita Baiana (O Corti√ßo): determinismo social

FUN√á√ÉO NARRATIVA:
Os personagens s√£o ve√≠culos dos temas e valores da obra, representando diferentes aspectos da condi√ß√£o humana e social.""",
            "category": "analysis"
        },
        {
            "question": "O que foi o Realismo no Brasil?",
            "answer": """O Realismo brasileiro (1881-1893) foi um movimento liter√°rio que rompeu com o idealismo rom√¢ntico, retratando a realidade social brasileira com objetividade e senso cr√≠tico.

MARCO INICIAL:
‚Ä¢ 1881: "Mem√≥rias P√≥stumas de Br√°s Cubas" (Machado de Assis)
‚Ä¢ "O Mulato" (Alu√≠sio Azevedo)
‚Ä¢ Fim do Romantismo, in√≠cio da an√°lise social

CARACTER√çSTICAS GERAIS:
‚Ä¢ Objetividade e imparcialidade narrativa
‚Ä¢ Cr√≠tica social e pol√≠tica
‚Ä¢ An√°lise psicol√≥gica dos personagens
‚Ä¢ Retrato fiel da realidade contempor√¢nea
‚Ä¢ Linguagem clara e direta
‚Ä¢ Determinismo social (Naturalismo)

PRINCIPAIS TEMAS:
‚Ä¢ Hipocrisia da sociedade burguesa
‚Ä¢ Corrup√ß√£o pol√≠tica e social
‚Ä¢ Conflitos psicol√≥gicos
‚Ä¢ Rela√ß√µes amorosas realistas
‚Ä¢ Cr√≠tica ao casamento por interesse
‚Ä¢ Quest√£o racial e escravid√£o

VERTENTES:
‚Ä¢ Realismo propriamente dito: an√°lise psicol√≥gica (Machado)
‚Ä¢ Naturalismo: determinismo cient√≠fico (Alu√≠sio Azevedo)

PRINCIPAIS AUTORES:
‚Ä¢ Machado de Assis: mestre da an√°lise psicol√≥gica
‚Ä¢ Alu√≠sio Azevedo: principal naturalista
‚Ä¢ Raul Pomp√©ia: "O Ateneu" (realismo memorialista)

OBRAS FUNDAMENTAIS:
‚Ä¢ "Dom Casmurro", "Quincas Borba" (Machado)
‚Ä¢ "O Corti√ßo" (Alu√≠sio Azevedo)
‚Ä¢ "O Ateneu" (Raul Pomp√©ia)

LEGADO:
O Realismo trouxe maturidade √† literatura brasileira, estabelecendo a cr√≠tica social como fun√ß√£o da arte.""",
            "category": "movement"
        },
        {
            "question": "Quais s√£o as principais t√©cnicas narrativas na literatura?",
            "answer": """As t√©cnicas narrativas s√£o recursos utilizados pelos escritores para contar suas hist√≥rias, influenciando diretamente a percep√ß√£o do leitor e a constru√ß√£o do sentido da obra.

TIPOS DE NARRADOR:
‚Ä¢ 1¬™ pessoa (protagonista): "Eu" conta sua pr√≥pria hist√≥ria
‚Ä¢ 1¬™ pessoa (testemunha): "Eu" narra hist√≥ria de outro
‚Ä¢ 3¬™ pessoa (onisciente): sabe tudo sobre personagens
‚Ä¢ 3¬™ pessoa (observador): limitado ao que v√™
‚Ä¢ Narrador n√£o-confi√°vel: vers√£o question√°vel dos fatos

FOCO NARRATIVO:
‚Ä¢ Interno: dentro da mente dos personagens
‚Ä¢ Externo: observa√ß√£o de comportamentos
‚Ä¢ M√∫ltiplo: altern√¢ncia entre diferentes perspectivas
‚Ä¢ C√¢mera: registro objetivo sem interpreta√ß√£o

TEMPO NARRATIVO:
‚Ä¢ Cronol√≥gico: sequ√™ncia linear dos eventos
‚Ä¢ Psicol√≥gico: tempo subjetivo da consci√™ncia
‚Ä¢ Flashback: volta ao passado
‚Ä¢ Fluxo de consci√™ncia: pensamentos livres

T√âCNICAS ESPECIAIS:
‚Ä¢ Metalinguagem: narrativa que se discute
‚Ä¢ Discurso indireto livre: fus√£o narrador/personagem
‚Ä¢ Mon√≥logo interior: pensamentos diretos
‚Ä¢ Intertextualidade: di√°logo com outras obras

EXEMPLOS BRASILEIROS:
‚Ä¢ Dom Casmurro: narrador n√£o-confi√°vel
‚Ä¢ Mem√≥rias P√≥stumas: narrador defunto
‚Ä¢ O Corti√ßo: foco m√∫ltiplo
‚Ä¢ Grande Sert√£o: mon√≥logo

FUN√á√ÉO:
Essas t√©cnicas determinam como a hist√≥ria √© contada e interpretada, sendo essenciais para a an√°lise liter√°ria.""",
            "category": "analysis"
        },
        {
            "question": "Quem foi Lima Barreto?",
            "answer": """Afonso Henriques de Lima Barreto (1881-1922) foi um escritor brasileiro do Pr√©-Modernismo, conhecido por sua cr√≠tica social contundente e por retratar a marginaliza√ß√£o social no in√≠cio do s√©culo XX.

BIOGRAFIA:
‚Ä¢ Nascimento: 13 de maio de 1881, Rio de Janeiro
‚Ä¢ Origem: fam√≠lia humilde, pai tip√≥grafo, descendente de escravos
‚Ä¢ Forma√ß√£o: Escola Polit√©cnica (n√£o concluiu)
‚Ä¢ Profiss√£o: funcion√°rio p√∫blico, jornalista
‚Ä¢ Problemas: alcoolismo, interna√ß√µes psiqui√°tricas
‚Ä¢ Morte: 1¬∫ de novembro de 1922, Rio de Janeiro

CARACTER√çSTICAS LITER√ÅRIAS:
‚Ä¢ Cr√≠tica social direta e militante
‚Ä¢ Den√∫ncia do preconceito racial
‚Ä¢ Retrato da vida urbana carioca
‚Ä¢ Linguagem simples e popular
‚Ä¢ Ironia e humor amargo
‚Ä¢ Protagonistas marginalizados

OBRAS PRINCIPAIS:
‚Ä¢ "Triste Fim de Policarpo Quaresma": cr√≠tica ao nacionalismo ing√™nuo
‚Ä¢ "O Corti√ßo": vida nos sub√∫rbios cariocas
‚Ä¢ "Recorda√ß√µes do Escriv√£o Isa√≠as Caminha": semi-autobiogr√°fica
‚Ä¢ Contos: "Clara dos Anjos"

TEMAS CENTRAIS:
‚Ä¢ Racismo e preconceito social
‚Ä¢ Cr√≠tica √† Rep√∫blica Velha
‚Ä¢ Moderniza√ß√£o excludente do Rio
‚Ä¢ Loucura e marginaliza√ß√£o
‚Ä¢ Burocracy e corrup√ß√£o

IMPORT√ÇNCIA:
Lima Barreto antecipou temas do Modernismo, sendo precursor da literatura social brasileira. Sua obra denuncia as injusti√ßas sociais com realismo cru e humanidade profunda.""",
            "category": "author"
        }
    ]

    # Executar adi√ß√µes
    results = []
    for i, item in enumerate(items_to_add, 4):
        print(f"\nüìö ITEM {i}/10 - {item['question'][:50]}...")
        try:
            result = training_service.add_knowledge(
                question=item['question'],
                answer=item['answer'],
                category=item['category'],
                source="expansion_literatura_brasileira_2025"
            )
            results.append(result)
            print(f"   ‚úÖ Resultado: {result}")
        except Exception as e:
            print(f"   ‚ùå Erro: {e}")
            results.append({'success': False, 'error': str(e)})

    # Resumo
    print("\n" + "=" * 60)
    print("üìä EXPANS√ÉO COMPLETA!")
    print("=" * 60)

    successful = sum(1 for r in results if r.get('success'))
    print(f"‚úÖ Itens adicionados com sucesso: {successful}/7")
    print(f"‚ùå Falhas: {7 - successful}")

    # Status final
    print("\nüìà STATUS FINAL:")
    final_stats = training_service.get_knowledge_stats()
    print(f"   üìö Total de itens: {final_stats.get('total_items', 0)}")
    print(f"   ‚úÖ Itens ativos: {final_stats.get('active_items', 0)}")
    print(f"   üß† Com embeddings: {final_stats.get('with_embeddings', 0)}")
    print(f"   üìÇ Categorias: {final_stats.get('categories', {})}")

    expected_total = 6 + successful  # 6 existentes + novos
    actual_total = final_stats.get('active_items', 0)

    if actual_total >= expected_total:
        print(f"\nüéâ EXPANS√ÉO CONCLU√çDA COM SUCESSO!")
        print(f"üìä Base expandida de 6 para {actual_total} itens")
        print(f"üöÄ Sistema h√≠brido com {actual_total} itens de conhecimento!")

        # Testar busca
        print(f"\nüß™ TESTE R√ÅPIDO DE BUSCA:")
        try:
            test_results = training_service.search_knowledge("Jos√© de Alencar", limit=3, threshold=0.3)
            print(f"   üîç Busca 'Jos√© de Alencar': {len(test_results)} resultado(s)")
            for i, result in enumerate(test_results, 1):
                confidence = getattr(result, 'confidence', 0)
                question = getattr(result, 'question_found', 'N/A')
                print(f"     {i}. {question[:50]}... (conf: {confidence:.2f})")
        except Exception as e:
            print(f"   ‚ùå Erro na busca: {e}")

        return True
    else:
        print(f"\n‚ö†Ô∏è EXPANS√ÉO PARCIAL")
        print(f"üìä Esperado: {expected_total}, Atual: {actual_total}")
        return False


if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)